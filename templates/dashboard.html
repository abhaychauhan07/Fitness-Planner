<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard ‚Äî FitPlanner</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</head>
<body>
  <nav class="topbar">
    <div class="brand"><img src="{{ url_for('static', filename='img/logo.svg') }}" alt="logo"><div class="small">FitPlanner</div></div>
    <div class="nav-actions">
      <a class="small" style="color:var(--muted);transition:var(--transition-fast);" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--muted)'">{{ session.get('name') }}</a>
      <a class="btn outline" href="{{ url_for('community') }}">Community</a>
      <a class="btn" href="{{ url_for('recommendations') }}">Recommendations</a>
      <a class="btn outline" href="{{ url_for('logout') }}" style="background:rgba(255,122,89,0.1);border-color:rgba(255,122,89,0.3);color:#FF7A59;">Logout</a>
    </div>
  </nav>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container" style="margin-top:16px;">
        <ul class="flashes">
        {% for category, msg in messages %}
          <li class="{{ category }}">{{ msg }}</li>
        {% endfor %}
        </ul>
      </div>
    {% endif %}
  {% endwith %}
  <div class="container">
    <div class="grid">
      <div>
        <div class="card profile">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <h3 style="margin:0;">{{ user['name'] }}</h3>
            <a href="{{ url_for('edit_profile') }}" class="btn outline" style="padding:6px 12px;font-size:12px;">‚úèÔ∏è Edit Profile</a>
          </div>
          <p class="small">Email: {{ user['email'] }}</p>
          <div class="stats">
            <div class="stat"><div class="small">Weight</div><div style="font-weight:800">{{ user['weight_kg'] or '‚Äî' }} kg</div></div>
            <div class="stat"><div class="small">Height</div><div style="font-weight:800">{{ user['height_cm'] or '‚Äî' }} cm</div></div>
            <div class="stat"><div class="small">Activity</div><div style="font-weight:800">{{ user['activity_level'] or '‚Äî' }}</div></div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="section-title"><h4>Recent Workouts</h4><a class="small" href="{{ url_for('add_workout') }}">Add</a></div>
          <ul class="list">
            {% for w in workouts %}
              <li>{{ w['date'] }} ‚Äî {{ w['workout_type'] }} ({{ w['duration_min'] }} min)</li>
            {% else %}
              <li class="small">No workouts yet.</li>
            {% endfor %}
          </ul>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="section-title"><h4>Recent Diet</h4><a class="small" href="{{ url_for('add_diet') }}">Add</a></div>
          <ul class="list">
            {% for d in diets %}
              <li>{{ d['date'] }} ‚Äî {{ d['meal_type'] }} ({{ d['calories'] }} kcal)</li>
            {% else %}
              <li class="small">No diet entries yet.</li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <div>
        <div class="card">
          <h4>Weekly Steps</h4>
          <canvas id="stepsChart" width="300" height="180"></canvas>
          <script>
          document.addEventListener('DOMContentLoaded', function(){
            const labels = [{% for s in steps %}'{{ s['recorded_at'] }}',{% endfor %}];
            const data = [{% for s in steps %}{{ s['steps'] }},{% endfor %}];
            renderLineChart('stepsChart', labels.reverse(), data.reverse(), 'Steps');
          });
          </script>
        </div>

        <div class="card" style="margin-top:12px">
          <h4>Community</h4>
          {% if community %}
            <p class="small">Points: <strong>{{ community['points'] }}</strong></p>
            <p class="small">Badges: <span class="badge">{{ community['badges'] }}</span></p>
          {% else %}
            <p class="small">Join the community to earn points.</p>
          {% endif %}
          <p style="margin-top:8px"><a class="small" href="{{ url_for('community') }}">View leaderboard</a></p>
        </div>

        <div class="card" style="margin-top:12px">
          <h4>Quick Actions</h4>
          <div style="display:flex;flex-direction:column;gap:8px">
            <a class="btn" href="{{ url_for('add_workout') }}">üí™ Log Workout</a>
            <a class="btn outline" href="{{ url_for('add_diet') }}">üçΩÔ∏è Log Meal</a>
            <a class="btn outline" href="{{ url_for('wearable') }}">‚åö Add Wearable Data</a>
            <a class="btn outline" href="{{ url_for('schedule') }}">üìÖ My Schedule</a>
          </div>
        </div>

      </div>
    </div>

    <div class="footer">Demo app for evaluation ‚Äî Option B theme</div>
  </div>
</body>
</html>
